%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University/School Laboratory Report
% LaTeX Template
% Version 3.0 (4/2/13)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Linux and Unix Users Group at Virginia Tech Wiki 
% (https://vtluug.org/wiki/Example_LaTeX_chem_lab_report)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[11pt]{article}
\usepackage{amssymb, amsmath}
\usepackage{url}
\usepackage{graphicx}
\usepackage{courier}
%\usepackage{times} % Uncomment to use the Times New Roman font

%----------------------------------------------------------------------------------------
%	DOCUMENT INFORMATION
%----------------------------------------------------------------------------------------

\title{Parallel Memory Allocation \\ A Scalable Solution \\ CSC469} % Title

\date{\today} % Date for the report

\begin{document}

\maketitle % Insert the title, author and date

\begin{center}
\begin{tabular}{l r}
Partners: & Daniel Bloemendal \\ % Partner names
& Simon Scott \\
Instructor: & Professor Angela Demke Brown % Instructor/supervisor
\end{tabular}
\end{center}

% If you wish to include an abstract, uncomment the lines below
% \begin{abstract}
% Abstract text
% \end{abstract}

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------

\section{Motivation}

\indent \indent To create a scalable parallel memory allocator that is at least as fast as the standard c malloc.


\section{Hoard Implementation}

\indent \indent We choose to implement the Hoard Memory Allocator based on both its proven history and its utilization in modern Operating Systems.  We use a global heap, and a CPU scaling factor which can be experimentally set to determine a number of per CPU heaps to initilize.  Threads are assigned to run on specific heaps.  The CPU scaling factor along with a more advanced hashing function help to prevent concurrent threads from being assigned to the same CPU.
\\
\newpage
\noindent
\textbf{Blowup}
\\
\indent  Utilizing an \textit{emptyness threshold} which can be experimentally set, we divide the Superblocks in a specific per processor heap by \textit{fullness groups}.  When a heap drops below the emptyness threshold, we transfer a superblock that is at least emptyness threshold empty from the appropriate \textit{fullnes bin}.  By implementing this threshold, the invarient that Berger et. al. used in their experiments in their canonical paper holds (CITATION).  Namely when we remove a superblock we reduce the amount of memory in use \textit{ui} by at most (1-\textit{emptyness threshold}), but we reduce the amount of memory allocated by Hoard from the Operating System \textit{ai} by \textit{S} the size of a superblock.   Maintaining this invarient bounds blowup to a constant factor (CITATION).  
\\
\textbf{Locality}
\\
\indent Allocated memory if requested from the highest \textit{fullness groups} first.  Fullness groups are also maintained in order of most recently freed\textit{(move to front heuristic)}.  Blocks that are reallocated are thus likley to still be in a Superblock already in memory.  Free blocks are in LIFO, so we are also liklet to use a block that is already in the cache.
\\
\textbf{Fragmentation}
\\
\indent Inside Superblocks.  Superblocks use size classes for their blocks which can be experimentally set.  Size classes are powers of \textit{b} (where \textit{b} $>$ 1), and limit internal fragmentation to a factor of \textit{b} (CITATION) pp\#2. \textit{b} can be experimentally set.  
\\
\indent Outside Superblocks.  Superblocks are not returned to the Operating System, they are \textit{recycled} for use by any size class.
\\
\textbf{False Sharing}
\\
\indent Hoard utilizes Superblocks and multiplle heaps to avoid most active and passive false sharing.   Superblocks only ser   Although when the \textit{emptyness threshold} is reached and a Superblock is returned to the Global heap there is then the possibility of false sharing, Berger et. al. find in practice the returned Superblocks are mainly completley empty (CITATION PP3).

\newpage

\section{Structures}

\textbf{Superblock}
\texttt{
\\
struct SUPERBLOCK\_T \{
\\
\indent   heap\_t* heap;
\\
\indent   uint8\_t group;
\\
\indent    int size\_class;
\\
\indent    size\_t block\_size;
\\
\indent    size\_t block\_count;
\\
\indent    size\_t block\_used;
\\
\indent    blockptr\_t next\_block;
\\
\indent    blockptr\_t next\_free;
\\
\indent    superblock\_t\* prev;
\\
\indent    superblock\_t\* next;
\\
\} \_\_attribute\_\_((aligned(ARCH\_CACHE\_ALIGNMENT)));
}
\\
\\

\noindent \textbf{Heap}
\\
\texttt{struct HEAP\_T \{
\\
\indent    int index;
\\
\indent    size\_t mem\_used;
\\
 \indent   size\_t mem\_allocated;
\\
 \indent   superblock\_t\* bins[ALLOC\_HOARD\_FULLNESS\_GROUPS];
\\
\};}

\newpage
\noindent
\section{Results}
\textbf{Speed}
\\
\textbf{Scalability}
\\
\section{Discussion}
 
%----------------------------------------------------------------------------------------
%	SECTION 2
%----------------------------------------------------------------------------------------

\newpage
\noindent
%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------
\section{References}
\bibliographystyle{unsrt}
Berger, Emery. "Hoard: A Scalable Memory Allocator for Multithreaded Applications." UMass CS | School of Computer Science. N.p., n.d. Web. 11 Nov. 2013. <http://people.cs.umass.edu/>.
\bibliography{sample}
\\
\\
Berger, Emery. "Hoard: A Fast, Scalable, and Memory-Efficient Allocator for Shared-Memory Multiprocessors." Ftp://ftp.cs.utexas.edu. N.p., n.d. Web. <ftp://ftp.cs.utexas.edu/pub/techreports/tr99-22.pdf>.

%----------------------------------------------------------------------------------------


\end{document}
